!function(t,e){"function"==typeof define&&define.amd?define(["$"],e):"object"==typeof exports?module.exports=e():t.ImageZooming=e(window.Zepto||window.jQuery||$)}(this,function(t){function e(){var t=Math.random().toString().replace(".","");this.id="imagezooming_"+t}return t.fn.ImageZooming=function(i){var s=[];return t(this).each(function(){var o=t.extend({target:t(this)},i),n=new e;n.init(o),s.push(n)}),s},e.prototype={init:function(e){this.settings=t.extend({target:t(),width:100,height:100,always:!1,times:2,handle:!1,callback:null},e),this.settings.target=t(this.settings.target),this.zoom=t("#"+this.id),this.bindEvent()},bindEvent:function(){var e=this;if(this.settings.always){e.createZooming.call(e,this.settings.target);{var i=this.settings.target,s=t(i).offset();t(i).height(),t(i).width()}e.setPosition.call(e,i.width()/2+s.left,i.height()/2+s.top,i)}e.zoom.on("touchmove",function(t){return e.event.zoommove.call(this,t,e)});var o=!1;e.zoom.on("mousedown",function(t){o=!0}),t("body").on("mouseup","#"+e.id,function(t){return o=!1,e.event.mouseup.call(this,t,e)}),t("body").on("mousemove","#"+e.id,function(t){return o&&e.event.zoommove.call(this,t,e)}),t(this.settings.target).on("touchstart",function(t){e.event.mousedown.call(this,t,e)}),t(this.settings.target).on("mousedown",function(t){e.event.mousedown.call(this,t,e),o=!0}),t(this.settings.target).on("touchmove",function(t){return e.event.mousemove.call(this,t,e)}),t(this.settings.target).on("mousemove",function(t){return o&&e.event.mousemove.call(this,t,e)}),t(this.settings.target).on("touchend",function(t){return e.event.mouseup.call(this,t,e)}),t(this.settings.target).on("mouseup",function(t){return e.event.mouseup.call(this,t,e)})},event:{zoommove:function(t,e){var i=t.changedTouches?t.changedTouches[0]:t;return e.setPosition.call(e,i.pageX,i.pageY,e.settings.target),!1},mousedown:function(t,e){var i=t.changedTouches?t.changedTouches[0]:t;e.createZooming.call(e,this),e.setPosition.call(e,i.pageX,i.pageY,this)},mousemove:function(t,e){var i=t.changedTouches?t.changedTouches[0]:t;return e.setPosition.call(e,i.pageX,i.pageY,this),!1},mouseup:function(t,e){return e.removeZooming(),!1}},removeZooming:function(){this.settings.always||this.zoom.hide()},createZooming:function(e){0===this.zoom.size()&&(this.zoom=t('<div id="'+this.id+'" style="position:absolute;background:none;"/>'),t("body").append(this.zoom),this.zoom.height(this.settings.height),this.zoom.width(this.settings.width),this.settings.handle&&(this.handle=t('<div class="zoom-handle"/>'),this.zoom.append(this.handle),this.handle.css({border:"1px solid #ccc",height:this.settings.height/2,width:10,top:this.settings.height,left:this.settings.width/2-5,position:"absolute"})),this.zoom.css({background:"url("+t(e).attr("src")+") no-repeat ",borderRadius:this.settings.width+"px "+this.settings.height+"px",border:"1px solid #ccc"})),this.zoom.show()},setPosition:function(e,i,s){this.settings.handle&&(i-=this.settings.height/2+this.handle.height()/2);var o=t(s).offset(),n=t(s).height(),h=t(s).width();e=Math.min(e,o.left+h),e=Math.max(e,o.left),i=Math.min(i,o.top+n),i=Math.max(i,o.top);var a={x:e-this.settings.width/2,y:i-this.settings.height/2},g={x:h*this.settings.times,y:n*this.settings.times},c={x:(e-o.left)*this.settings.times-this.settings.width/2,y:(i-o.top)*this.settings.times-this.settings.height/2};this.zoom.css({left:a.x,top:a.y,backgroundPosition:-c.x+"px "+-c.y+"px",backgroundSize:g.x+"px "+g.y+"px"}),this.settings.callback&&this.settings.callback(a,c,g,s,this.zoom)}},e});